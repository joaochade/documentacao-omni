<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integração | Conexa &lt;&gt; Omni</title>
    
    <!-- Mermaid via CDN -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default'
        });
    </script>
    
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2em;
        }
        
        h1 {
            font-size: 2.25em;
            font-weight: 300;
            padding-bottom: 0.3em;
            border-bottom: 2px solid #eee;
        }
        
        h2 {
            font-size: 1.75em;
            font-weight: 400;
            padding-bottom: 0.3em;
            margin-top: 2em;
            border-bottom: 1px solid #eee;
        }
        
        h3 {
            font-size: 1.5em;
            font-weight: 500;
            margin-top: 1.5em;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }
        
        table th {
            background-color: #f5f5f5;
            font-weight: 600;
            text-align: left;
            padding: 12px;
            border: 1px solid #ddd;
        }
        
        table td {
            padding: 10px 12px;
            border: 1px solid #ddd;
        }
        
        table tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        pre {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 3px solid #42a5f5;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        ul {
            padding-left: 2em;
        }
        
        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 2em 0;
        }
        
        strong {
            font-weight: 600;
        }
        
        .mermaid {
            margin: 2em 0;
        }
    </style>
</head>
<body>

<h1>Integração | Conexa &lt;&gt; Omni</h1>

<hr>

<p>Esta documentação descreve a integração técnica entre a Conexa e a Omni para disponibilização do benefício de medicamentos no app da Conexa por meio de WebView. O fluxo contempla o cadastro de usuários e dependentes, a criação e gestão de carteiras de benefício, a geração de links temporários com autenticação transparente e o envio de receitas médicas emitidas em teleconsultas. O objetivo é permitir que colaboradores elegíveis acessem o ambiente Omni diretamente pelo app da Conexa e realizem toda a jornada de consulta, prescrição e compra de medicamentos com cobertura, de forma integrada e contínua. O documento serve como referência técnica para implementação, testes e operação da integração.</p>

<hr>

<h2>01. Cadastro de Usuários</h2>

<h3>Criação de Usuários</h3>

<p><strong>Endpoint:</strong> <code>POST /v2/users</code></p>

<p>Cria um usuário na Omni vinculado a uma empresa, com suporte a dependentes via holderUserId.</p>

<table>
<thead>
<tr>
<th>Parâmetro</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>companyId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID da empresa</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Sim</td>
<td>Nome completo do usuário</td>
</tr>
<tr>
<td><code>cpf</code></td>
<td>string</td>
<td>Sim</td>
<td>CPF do usuário</td>
</tr>
<tr>
<td><code>dateOfBirth</code></td>
<td>string</td>
<td>Sim</td>
<td>Data de nascimento</td>
</tr>
<tr>
<td><code>gender</code></td>
<td>string</td>
<td>Não</td>
<td>Gênero do usuário (MALE ou FEMALE)</td>
</tr>
<tr>
<td><code>holderUserId</code></td>
<td>string</td>
<td>Não</td>
<td>ID do usuário titular (para dependentes)</td>
</tr>
</tbody>
</table>

<p><strong>Como obter os parâmetros:</strong></p>
<ul>
<li><code>companyId</code>: Obtido via <code>GET /v2/companies</code></li>
<li><code>holderUserId</code>: Obtido via <code>GET /v2/users/cpf/{cpf}</code> usando o CPF do titular</li>
</ul>

<p><strong>Observação importante:</strong> O titular precisa ser criado antes dos dependentes. Quando for criar um dependente, consulte o <code>userId</code> do titular via <code>GET /v2/users/cpf/{cpf}</code> e passe esse valor no parâmetro <code>holderUserId</code> do dependente.</p>

<p><strong>Exemplo de chamada - Titular:</strong></p>
<pre><code>POST /v2/users
{
  "companyId": "a3f2b8c1-4d5e-6f7a-8b9c-0d1e2f3a4b5c",
  "name": "João da Silva",
  "cpf": "123.456.789-00",
  "dateOfBirth": "1985-03-15",
  "gender": "MALE"
}
</code></pre>

<p><strong>Exemplo de chamada - Dependente:</strong></p>
<pre><code>POST /v2/users
{
  "companyId": "a3f2b8c1-4d5e-6f7a-8b9c-0d1e2f3a4b5c",
  "name": "Maria da Silva",
  "cpf": "987.654.321-00",
  "dateOfBirth": "2010-07-20",
  "gender": "FEMALE",
  "holderUserId": "7b4e9f2a-3c1d-4a5b-9e8f-6d7c8a9b0e1f"
}
</code></pre>

<hr>

<h3>Criação de Carteiras</h3>

<p><strong>Endpoint:</strong> <code>POST /v2/wallets</code></p>

<p>Cria uma carteira para um usuário com plano e vigência definidos.</p>

<table>
<thead>
<tr>
<th>Parâmetro</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>userId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID do usuário</td>
</tr>
<tr>
<td><code>companyId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID da empresa</td>
</tr>
<tr>
<td><code>planId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID do plano</td>
</tr>
<tr>
<td><code>validFrom</code></td>
<td>string</td>
<td>Sim</td>
<td>Data de início de validade</td>
</tr>
<tr>
<td><code>validUntil</code></td>
<td>string</td>
<td>Não</td>
<td>Data de fim de validade</td>
</tr>
</tbody>
</table>

<p><strong>Como obter os parâmetros:</strong></p>
<ul>
<li><code>userId</code>: Obtido via <code>GET /v2/users/cpf/{cpf}</code></li>
<li><code>companyId</code> e <code>planId</code>: Obtidos via <code>GET /v2/companies</code></li>
</ul>

<p><strong>Exemplo de chamada:</strong></p>
<pre><code>POST /v2/wallets
{
  "userId": "7b4e9f2a-3c1d-4a5b-9e8f-6d7c8a9b0e1f",
  "companyId": "a3f2b8c1-4d5e-6f7a-8b9c-0d1e2f3a4b5c",
  "planId": "5d8c3a7f-2e1b-4f9a-8c6d-1a2b3c4d5e6f",
  "validFrom": "2024-01-01",
  "validUntil": "2024-12-31"
}
</code></pre>

<hr>

<h2>02. Link de Acesso ao Webview</h2>

<h3>Criação do Link Temporário</h3>

<p><strong>Endpoint:</strong> <code>POST /v2/temporary-links</code></p>

<p>Gera um link temporário autenticado para acesso ao WebView da Omni.</p>

<table>
<thead>
<tr>
<th>Parâmetro</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>userId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID do usuário</td>
</tr>
<tr>
<td><code>companyId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID da empresa</td>
</tr>
</tbody>
</table>

<p><strong>Como obter os parâmetros:</strong></p>
<ul>
<li><code>userId</code>: Obtido via <code>GET /v2/users/cpf/{cpf}</code></li>
<li><code>companyId</code>: Obtido via <code>GET /v2/companies</code></li>
</ul>

<p><strong>Exemplo de chamada:</strong></p>
<pre><code>POST /v2/temporary-links
{
  "userId": "7b4e9f2a-3c1d-4a5b-9e8f-6d7c8a9b0e1f",
  "companyId": "a3f2b8c1-4d5e-6f7a-8b9c-0d1e2f3a4b5c"
}
</code></pre>

<hr>

<h2>03. Envio de Receitas</h2>

<h3>Processar Receitas por URL</h3>

<p><strong>Endpoint:</strong> <code>POST /v2/prescriptions/process-urls</code></p>

<p>Envia receitas médicas para a Omni via URL, vinculadas ao usuário e à carteira.</p>

<table>
<thead>
<tr>
<th>Parâmetro</th>
<th>Tipo</th>
<th>Obrigatório</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>companyId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID da empresa</td>
</tr>
<tr>
<td><code>userId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID do usuário</td>
</tr>
<tr>
<td><code>walletId</code></td>
<td>string</td>
<td>Sim</td>
<td>ID da carteira</td>
</tr>
<tr>
<td><code>prescriptions</code></td>
<td>array</td>
<td>Sim</td>
<td>Lista de prescrições</td>
</tr>
</tbody>
</table>

<p><strong>Como obter os parâmetros:</strong></p>
<ul>
<li><code>walletId</code>: Obtido via <code>GET /v2/users/cpf/{cpf}</code></li>
</ul>

<p><strong>Estrutura do array <code>prescriptions</code>:</strong></p>
<pre><code>[
  {
    "url": "https://exemplo.com/receita.pdf",
    "data": {}
  }
]
</code></pre>

<p><strong>Exemplo de chamada:</strong></p>
<pre><code>POST /v2/prescriptions/process-urls
{
  "companyId": "a3f2b8c1-4d5e-6f7a-8b9c-0d1e2f3a4b5c",
  "userId": "7b4e9f2a-3c1d-4a5b-9e8f-6d7c8a9b0e1f",
  "walletId": "9e3f7b2d-1a4c-5e6f-8b9a-0c1d2e3f4a5b",
  "prescriptions": [
    {
      "url": "https://storage.conexa.com/prescriptions/receita_001.pdf",
      "data": {}
    }
  ]
}
</code></pre>

<p><strong>Observação sobre formatos:</strong> A Omni está preparada para receber receitas em diferentes formatos. O endpoint suporta tanto URLs de arquivos PDF quanto dados estruturados em JSON no campo <code>data</code>. A Conexa pode enviar as receitas no formato que for mais conveniente para sua infraestrutura, e a Omni se adaptará ao formato recebido.</p>

<hr>

<h2>Fluxograma da Integração</h2>

<div class="mermaid">
---
config:
  look: neo
  layout: dagre
---
flowchart TB
 subgraph Legend[" "]
        L1["Ação do Cliente B2B"]
        L2["Integração Conexa → Omni"]
        L3["Ação do Usuário Final"]
        L4["Fim do Fluxo"]
  end
    A["Cliente B2B envia base de colaboradores na Conexa"] --> B["Conexa identifica colaboradores com benefício Omni ativo"]
    B --> D["Criar usuário na Omni<br>POST /v2/users"]
    D --> F["Criar carteira do usuário<br>POST /v2/wallets"]
    F --> G["Usuário acessa app Conexa e clica em<br>Benefício de Medicamentos"]
    G --> H["Conexa gera link temporário autenticado na Omni<br>POST /v2/temporary-links"]
    H --> I["Conexa abre WebView Omni com link temporário"]
    I --> J{"Usuário realizou teleconsulta<br>e recebeu receita?"}
    J -- Sim --> K["Conexa envia receita para Omni<br>POST /v2/prescriptions/process-urls"]
    J -- Não --> L["Fim: usuário pode navegar no ambiente Omni"]
    K --> M["Fim: receita disponível no ambiente Omni"]
    
    style L1 fill:#f5f5f5,stroke:#999,stroke-width:2px
    style L2 fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style L3 fill:#e8f5e9,stroke:#66bb6a,stroke-width:2px
    style L4 fill:#fafafa,stroke:#bdbdbd,stroke-width:1px
    style A fill:#f5f5f5,stroke:#999,stroke-width:2px
    style B fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style D fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style F fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style G fill:#e8f5e9,stroke:#66bb6a,stroke-width:2px
    style H fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style I fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style K fill:#e3f2fd,stroke:#42a5f5,stroke-width:2px
    style L fill:#fafafa,stroke:#bdbdbd,stroke-width:1px
    style M fill:#fafafa,stroke:#bdbdbd,stroke-width:1px
    style Legend fill:#fff,stroke:#ddd,stroke-width:1px
</div>

</body>
</html>
